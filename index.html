<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Macca Stock v19.8</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'macca-dark': '#0a0a0c',
                        'macca-card': '#16161a',
                        'macca-yellow': '#fbbf24',
                        'macca-green': '#22c55e',
                        'macca-blue': '#3b82f6',
                        'macca-red': '#ef4444',
                        'macca-purple': '#a855f7',
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0a0a0c; color: white; -webkit-tap-highlight-color: transparent; font-family: 'Plus Jakarta Sans', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.2s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .nav-item.active { color: #fbbf24; }
        .nav-item.active i { transform: translateY(-3px); color: #fbbf24; }
        .fab-right { position: fixed; bottom: 100px; right: 20px; z-index: 50; display: flex; flex-direction: column; align-items: center; gap: 12px; }
        .fab-sub { width: 60px; height: 60px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform: scale(0); opacity: 0; pointer-events: none; }
        .fab-main { width: 70px; height: 70px; border-radius: 50%; background: #fbbf24; color: #000; display: flex; align-items: center; justify-content: center; font-size: 28px; box-shadow: 0 8px 25px rgba(251, 191, 36, 0.3); z-index: 52; }
        .fab-quick { width: 70px; height: 70px; border-radius: 50%; background: #ef4444; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3); border: 3px solid #0a0a0c; }
        .fab-right.active .fab-sub { transform: scale(1); opacity: 1; pointer-events: auto; }
        #qty { font-size: 80px !important; line-height: 1; height: 100px; }
        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body class="antialiased pb-24">

    <div id="section-login" class="fixed inset-0 z-[100] bg-macca-dark flex flex-col items-center justify-center px-8 text-center">
        <h1 class="text-5xl font-black text-macca-yellow italic mb-1 uppercase">MACCA<span class="text-white">.v19</span></h1>
        <p class="text-slate-500 text-[10px] font-bold uppercase mb-10 tracking-widest">Management System</p>
        <div class="w-full max-w-xs space-y-5">
            <input type="password" id="login-code" inputmode="numeric" placeholder="KODE" class="w-full p-5 bg-macca-card rounded-3xl text-center text-4xl font-black text-macca-yellow outline-none border border-white/10">
            <button onclick="handleLogin()" class="w-full bg-macca-yellow text-black font-black py-6 rounded-3xl uppercase tracking-widest active:scale-95 transition-transform">MASUK</button>
        </div>
    </div>

    <div id="section-app" class="hidden">
        <nav class="px-6 py-5 flex justify-between items-center bg-macca-dark sticky top-0 z-40 border-b border-white/5">
            <div>
                <h1 class="text-xl font-black italic text-macca-yellow uppercase">Macca Stock</h1>
                <p id="display-user-name" class="text-[10px] text-macca-green font-bold uppercase"></p>
            </div>
            <button onclick="location.reload()" class="w-10 h-10 bg-macca-card rounded-xl flex items-center justify-center text-macca-red border border-white/10"><i class="fas fa-power-off"></i></button>
        </nav>

        <main class="max-w-md mx-auto p-4">
            <div id="tab-home" class="tab-content active space-y-6">
                <section class="bg-macca-card rounded-[2.5rem] p-6 border border-white/5 shadow-xl text-center">
                    <p class="text-[10px] font-bold text-macca-green uppercase tracking-widest mb-1">Omzet Tunai Hari Ini</p>
                    <h2 id="total-omzet" class="text-4xl font-black text-white mb-5">Rp 0</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-black/30 p-4 rounded-2xl border border-white/5 text-left">
                            <p class="text-[9px] text-slate-500 uppercase font-bold mb-1">Ayam (Tunai)</p>
                            <h2 id="count-ayam-sales" class="text-xl font-black text-macca-yellow">0</h2>
                            <p id="omzet-ayam" class="text-[9px] text-slate-400">Rp 0</p>
                        </div>
                        <div class="bg-black/30 p-4 rounded-2xl border border-white/5 text-left">
                            <p class="text-[9px] text-slate-500 uppercase font-bold mb-1">Ikan (Tunai)</p>
                            <h2 id="count-ikan-sales" class="text-xl font-black text-macca-blue">0</h2>
                            <p id="omzet-ikan" class="text-[9px] text-slate-400">Rp 0</p>
                        </div>
                    </div>
                </section>

                <div class="grid grid-cols-3 gap-2">
                    <div class="bg-macca-card p-4 rounded-2xl border border-white/5 text-center">
                        <p class="text-[9px] font-bold text-slate-500 uppercase mb-1">Mentah</p>
                        <p id="stat-mentah-main" class="text-xl font-black text-slate-300">0</p>
                    </div>
                    <div class="bg-macca-card p-4 rounded-2xl border border-white/5 text-center">
                        <p class="text-[9px] font-bold text-slate-500 uppercase mb-1">Ungkep</p>
                        <p id="stat-ungkep-main" class="text-xl font-black text-macca-yellow">0</p>
                    </div>
                    <div class="bg-macca-card p-4 rounded-2xl border border-white/5 text-center">
                        <p class="text-[9px] font-bold text-slate-500 uppercase mb-1">Ikan</p>
                        <p id="stat-ikan-main" class="text-xl font-black text-macca-green">0</p>
                    </div>
                </div>
            </div>

            <div id="tab-history" class="tab-content space-y-3">
                <h3 class="text-xs font-black text-white uppercase italic tracking-widest px-2">Riwayat Hari Ini</h3>
                <div id="history-list" class="space-y-3"></div>
            </div>

            <div id="tab-rekap" class="tab-content space-y-6">
                <section class="space-y-3">
                    <h3 class="text-xs font-black text-white uppercase italic tracking-widest px-2"><i class="fas fa-calendar-day mr-2 text-macca-yellow"></i>Rekap Penjualan Hari Ini</h3>
                    <div class="bg-macca-card rounded-3xl p-5 border border-white/5 shadow-xl overflow-hidden">
                        <table class="w-full text-[11px]">
                            <tbody id="rekap-harian-body"></tbody>
                        </table>
                    </div>
                </section>

                <section class="space-y-3">
                    <div class="flex items-center justify-between px-2">
                        <h3 class="text-xs font-black text-white uppercase italic tracking-widest"><i class="fas fa-calendar-alt mr-2 text-macca-blue"></i>Rekap Bulanan</h3>
                        <input type="month" id="filter-bulan" class="bg-macca-card border border-white/10 rounded-lg text-[10px] p-2 outline-none text-macca-yellow">
                    </div>
                    <div class="bg-macca-card rounded-3xl p-5 border border-white/5 shadow-xl">
                        <table class="w-full text-left text-[11px]">
                            <thead>
                                <tr class="text-slate-500 border-b border-white/5 font-bold uppercase">
                                    <th class="py-3">Kategori</th>
                                    <th class="py-3 text-right">Qty</th>
                                    <th class="py-3 text-right">Total</th>
                                </tr>
                            </thead>
                            <tbody id="rekap-table-body"></tbody>
                            <tfoot>
                                <tr class="text-white border-t border-white/10">
                                    <th class="py-4 font-black uppercase">TOTAL (CASH+QRIS)</th>
                                    <th id="rekap-total-qty" class="py-4 text-right font-black">-</th>
                                    <th id="rekap-grand-total" class="py-4 text-right font-black text-macca-green">-</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <div id="bottom-nav" class="fixed bottom-0 left-0 right-0 bg-macca-card border-t border-white/10 px-8 py-4 flex justify-between items-center z-50 hidden">
        <button onclick="switchTab('home')" class="nav-item active flex flex-col items-center gap-1 transition-all">
            <i class="fas fa-home text-xl"></i><span class="text-[9px] font-bold uppercase">Beranda</span>
        </button>
        <button onclick="switchTab('history')" class="nav-item flex flex-col items-center gap-1 transition-all">
            <i class="fas fa-history text-xl"></i><span class="text-[9px] font-bold uppercase">Riwayat</span>
        </button>
        <button onclick="switchTab('rekap')" class="nav-item flex flex-col items-center gap-1 transition-all">
            <i class="fas fa-chart-pie text-xl"></i><span class="text-[9px] font-bold uppercase">Rekap</span>
        </button>
    </div>

    <div id="fab-container-right" class="fab-right hidden">
        <div onclick="openInput('Ungkep')" class="fab-sub bg-macca-card border-2 border-macca-yellow"><span class="text-[9px] font-black text-macca-yellow uppercase">UNGKEP</span></div>
        <div onclick="openInput('Ikan')" class="fab-sub bg-macca-card border-2 border-macca-green"><span class="text-[9px] font-black text-macca-green uppercase">IKAN</span></div>
        <div onclick="openInput('Mentah')" class="fab-sub bg-macca-card border-2 border-macca-blue"><span class="text-[9px] font-black text-macca-blue uppercase">MENTAH</span></div>
        <button id="main-fab-btn" onclick="toggleFab()" class="fab-main"><i class="fas fa-plus"></i></button>
        <button id="quick-fab-btn" onclick="openQuickSale()" class="fab-quick hidden"><i class="fas fa-cash-register text-2xl mb-1"></i><span class="text-[8px] font-black uppercase">JUAL</span></button>
    </div>

    <div id="modal-input" class="fixed inset-0 z-[80] bg-black/95 hidden flex items-end justify-center">
        <div class="bg-macca-card w-full max-w-md rounded-t-[3.5rem] p-7 pb-10 border-t border-white/10">
            <div class="flex justify-between items-center mb-6 px-2">
                <h2 class="text-3xl font-black uppercase italic text-macca-yellow" id="modal-title">QTY</h2>
                <div id="price-tag" class="text-right"><p id="display-price" class="text-xl font-black text-macca-green">Rp 0</p></div>
            </div>
            <div id="item-selector" class="flex gap-3 mb-6 hidden">
                <button onclick="selectItem('Ungkep')" id="sel-ayam" class="flex-1 py-5 rounded-2xl font-black text-sm border-2 border-macca-yellow text-macca-yellow">AYAM</button>
                <button onclick="selectItem('Ikan')" id="sel-ikan" class="flex-1 py-5 rounded-2xl font-black text-sm border-2 border-white/5 text-slate-500">IKAN</button>
            </div>
            <input type="number" id="qty" placeholder="0" class="w-full text-center font-black text-macca-yellow bg-transparent outline-none mb-6">
            <div id="note-section"><select id="note" onchange="updatePriceDisplay()" class="w-full p-5 bg-black rounded-2xl font-black text-center mb-8 outline-none text-white border border-white/10 appearance-none uppercase"></select></div>
            <div class="flex flex-col gap-3">
                <div class="flex gap-3">
                    <button onclick="closeInput()" class="flex-1 py-6 rounded-3xl font-black text-slate-500 uppercase">Batal</button>
                    <button id="btn-save-cash" onclick="saveData('CASH')" class="flex-[2] bg-macca-green text-black font-black py-6 rounded-3xl uppercase active:scale-95">SIMPAN (CASH)</button>
                </div>
                <button id="btn-save-qris" onclick="saveData('QRIS')" class="hidden w-full bg-macca-purple text-white font-black py-6 rounded-3xl uppercase active:scale-95 flex items-center justify-center gap-3">
                    <i class="fas fa-qrcode"></i> SIMPAN (QRIS)
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCCmKgOnBFpluEKuycYjrBRm4zbxrHI1P8",
            authDomain: "stocklistmacca.firebaseapp.com",
            databaseURL: "https://stocklistmacca-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "stocklistmacca",
            storageBucket: "stocklistmacca.firebasestorage.app",
            messagingSenderId: "277279553860",
            appId: "1:277279553860:web:22eb68808ed307ea76bf11"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const dbRef = ref(db, 'stok_macca_v14_flow');

        const PRICES = { "Ungkep": 14000, "Ikan": 13000, "Mentah": 0 };
        const USERS = {
            "1": { name: "Ibu Ati", type: "admin" },
            "2": { name: "Nita (Asisten)", type: "admin" },
            "3": { name: "Ara", type: "staff", notes: ["Penj. Kasir", "Penj. Grab", "Ayam Nasi Goreng", "Ayam Suir", "Ayam Karyawan", "Ayam Rusak"] },
            "4": { name: "Dilla", type: "staff", notes: ["Penj. Kasir", "Penj. Grab", "Ayam Nasi Goreng", "Ayam Suir", "Ayam Karyawan", "Ayam Rusak"] },
            "5": { name: "Rezky", type: "staff", notes: ["Penj. Gerai Depan"] },
            "6": { name: "Sendy", type: "staff", notes: ["Penj. Gerai Depan"] }
        };

        let activeUser = null, dataRaw = [], currentTabItem = 'Ungkep', currentMode = '';

        const dNow = new Date();
        const currentYearMonth = `${dNow.getFullYear()}-${(dNow.getMonth()+1).toString().padStart(2,'0')}`;
        document.getElementById('filter-bulan').value = currentYearMonth;
        document.getElementById('filter-bulan').addEventListener('change', () => render());

        window.switchTab = (tabId) => {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            event.currentTarget.classList.add('active');
        };

        window.handleLogin = () => {
            const val = document.getElementById('login-code').value;
            if (USERS[val]) { 
                activeUser = USERS[val]; 
                document.getElementById('section-login').classList.add('hidden');
                document.getElementById('section-app').classList.remove('hidden');
                document.getElementById('bottom-nav').classList.remove('hidden');
                document.getElementById('display-user-name').innerText = activeUser.name;
                document.getElementById('fab-container-right').classList.remove('hidden');
                if(activeUser.type === "admin") {
                    document.getElementById('main-fab-btn').classList.remove('hidden');
                    document.getElementById('quick-fab-btn').classList.add('hidden');
                } else {
                    document.getElementById('main-fab-btn').classList.add('hidden');
                    document.getElementById('quick-fab-btn').classList.remove('hidden');
                }
                onValue(dbRef, (snap) => { 
                    dataRaw = snap.val() ? Object.values(snap.val()) : []; 
                    render(); 
                });
            } else { alert("KODE SALAH!"); }
        };

        window.toggleFab = () => document.getElementById('fab-container-right').classList.toggle('active');

        window.selectItem = (t) => {
            currentTabItem = t;
            updatePriceDisplay();
            document.getElementById('sel-ayam').className = t === 'Ungkep' ? 'flex-1 py-5 rounded-2xl font-black text-sm border-2 border-macca-yellow text-macca-yellow bg-macca-yellow/5' : 'flex-1 py-5 rounded-2xl font-black text-sm border-2 border-white/5 text-slate-500';
            document.getElementById('sel-ikan').className = t === 'Ikan' ? 'flex-1 py-5 rounded-2xl font-black text-sm border-2 border-macca-green text-macca-green bg-macca-green/5' : 'flex-1 py-5 rounded-2xl font-black text-sm border-2 border-white/5 text-slate-500';
        };

        // Fungsi baru untuk update tampilan harga di modal
        window.updatePriceDisplay = () => {
            const noteVal = document.getElementById('note').value.toLowerCase();
            const freeItems = ['nasi goreng', 'suir', 'karyawan', 'rusak'];
            const isFree = freeItems.some(item => noteVal.includes(item));
            
            if (isFree && currentMode === 'Keluar') {
                document.getElementById('display-price').innerText = "Rp 0";
            } else {
                document.getElementById('display-price').innerText = "Rp " + PRICES[currentTabItem].toLocaleString();
            }
        };

        window.openQuickSale = () => {
            document.getElementById('item-selector').classList.remove('hidden');
            document.getElementById('btn-save-qris').classList.remove('hidden');
            document.getElementById('btn-save-cash').innerText = 'SIMPAN (CASH)';
            
            const sel = document.getElementById('note');
            if (activeUser.notes && activeUser.notes.length > 1) {
                document.getElementById('note-section').classList.remove('hidden');
                sel.innerHTML = `<option value="" disabled selected>-- PILIH TUJUAN --</option>`;
                activeUser.notes.forEach(n => { sel.innerHTML += `<option value="${n}">${n}</option>`; });
            } else { 
                document.getElementById('note-section').classList.add('hidden'); 
                sel.innerHTML = `<option value="${activeUser.notes[0]}">${activeUser.notes[0]}</option>`;
            }
            
            currentMode = 'Keluar';
            selectItem('Ungkep');
            document.getElementById('modal-title').innerText = 'JUAL';
            document.getElementById('modal-input').classList.remove('hidden');
        };

        window.openInput = (t) => {
            currentTabItem = t;
            document.getElementById('modal-title').innerText = t;
            document.getElementById('modal-input').classList.remove('hidden');
            document.getElementById('fab-container-right').classList.remove('active');
            document.getElementById('item-selector').classList.add('hidden');
            document.getElementById('btn-save-qris').classList.add('hidden');
            document.getElementById('btn-save-cash').innerText = 'SIMPAN';
            currentMode = t === 'Ungkep' ? 'Proses Ungkep' : 'Masuk';
            document.getElementById('note-section').classList.add('hidden');
            updatePriceDisplay();
        };

        window.closeInput = () => { document.getElementById('modal-input').classList.add('hidden'); document.getElementById('qty').value = ''; };

        window.saveData = (metode = 'CASH') => {
            const valQty = parseInt(document.getElementById('qty').value);
            if(!valQty) return alert("Isi Jumlah!");
            
            let noteStr = (activeUser.type === 'admin' && currentMode !== 'Keluar') 
                ? (currentMode === 'Proses Ungkep' ? "PROSES UNGKEP" : "TAMBAH STOK " + currentTabItem.toUpperCase()) 
                : document.getElementById('note').value;
                
            if(!noteStr) return alert("Pilih Tujuan!");
            
            // Logika Harga: Jika mengandung kata-kata freeItems, harga jadi 0
            const freeItems = ['nasi goreng', 'suir', 'karyawan', 'rusak'];
            const isFreeItem = freeItems.some(term => noteStr.toLowerCase().includes(term));
            
            let price = 0;
            if (!isFreeItem) {
                price = (noteStr.toLowerCase().includes('penj') || noteStr.toLowerCase().includes('grab') || noteStr.toLowerCase().includes('kasir') || noteStr.toLowerCase().includes('gerai')) ? PRICES[currentTabItem] : 0;
            }
            
            let finalNote = noteStr;
            if(metode === 'QRIS' && price > 0) finalNote += " (QRIS)";

            if(currentMode === 'Proses Ungkep') {
                push(dbRef, { user: activeUser.name, type: 'Mentah', qty: valQty, status: 'Keluar', note: 'PROSES UNGKEP (KELUAR)', price: 0, time: serverTimestamp() });
                push(dbRef, { user: activeUser.name, type: 'Ungkep', qty: valQty, status: 'Masuk', note: 'TAMBAH STOK UNGKEP (HASIL)', price: 0, time: serverTimestamp() }).then(() => closeInput());
            } else {
                push(dbRef, { user: activeUser.name, type: currentTabItem, qty: valQty, status: currentMode, note: finalNote, price: price, time: serverTimestamp() }).then(() => closeInput());
            }
        };

        function render() {
            let sM = 0, sU = 0, sI = 0; 
            let omzHarianTunai = 0, aQtyTunai = 0, iQtyTunai = 0, aOmzTunai = 0, iOmzTunai = 0;
            let rekapHarian = {}; let rekapBulanan = {}; let rGrandQ = 0; let rGrandT = 0;
            
            const startToday = new Date().setHours(0,0,0,0);
            const filterBln = document.getElementById('filter-bulan').value;
            const hl = document.getElementById('history-list'); hl.innerHTML = '';

            dataRaw.forEach(i => {
                const add = (i.status === 'Masuk') ? i.qty : -i.qty;
                if(i.type === 'Mentah') sM += add;
                else if(i.type === 'Ungkep') sU += add;
                else if(i.type === 'Ikan') sI += add;

                const dt = new Date(i.time);
                const isSale = i.price > 0;
                const isQRIS = i.note.includes("(QRIS)");
                const itemBulan = `${dt.getFullYear()}-${(dt.getMonth()+1).toString().padStart(2,'0')}`;

                // --- LOGIKA DASHBOARD HOME (Hanya Tunai) ---
                if(i.time >= startToday && isSale && !isQRIS) {
                    const lineTotal = i.qty * i.price;
                    omzHarianTunai += lineTotal;
                    if(i.type === 'Ungkep') { aQtyTunai += i.qty; aOmzTunai += lineTotal; } 
                    else if(i.type === 'Ikan') { iQtyTunai += i.qty; iOmzTunai += lineTotal; }
                }

                // --- REKAP HARIAN (Semua yang berharga > 0 masuk rekap omzet) ---
                if(i.time >= startToday && (isSale || i.status === 'Keluar')) {
                    const key = i.note;
                    if(!rekapHarian[key]) rekapHarian[key] = { qty: 0, total: 0 };
                    rekapHarian[key].qty += i.qty;
                    rekapHarian[key].total += (i.qty * i.price);
                }

                // --- REKAP BULANAN ---
                if(itemBulan === filterBln && (isSale || i.status === 'Keluar')) {
                    if(!rekapBulanan[i.note]) rekapBulanan[i.note] = { qty: 0, total: 0 };
                    rekapBulanan[i.note].qty += i.qty;
                    rekapBulanan[i.note].total += (i.qty * i.price);
                    rGrandQ += i.qty;
                    rGrandT += (i.qty * i.price);
                }

                // --- RIWAYAT ---
                if(i.time >= startToday) {
                    const tm = `${dt.getHours().toString().padStart(2,'0')}:${dt.getMinutes().toString().padStart(2,'0')}`;
                    const icon = i.status === 'Masuk' ? 'fa-arrow-down text-macca-green' : (isSale ? (isQRIS ? 'fa-qrcode text-macca-purple' : 'fa-tag text-macca-yellow') : 'fa-arrow-up text-macca-red');
                    let labelTipe = i.type;
                    if(i.status === 'Keluar' && i.type === 'Ungkep') labelTipe = 'AYAM';
                    
                    const freeItems = ['nasi goreng', 'suir', 'karyawan', 'rusak'];
                    const isFree = freeItems.some(term => i.note.toLowerCase().includes(term));
                    const labelFinal = isFree ? `PENGGUNAAN ${labelTipe.toUpperCase()}` : (isSale ? `PENJUALAN ${labelTipe.toUpperCase()}` : labelTipe.toUpperCase());

                    hl.innerHTML = `
                    <div class="bg-macca-card p-4 rounded-3xl border border-white/5 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center text-sm"><i class="fas ${icon}"></i></div>
                            <div>
                                <h4 class="font-black text-[10px] text-white uppercase">${i.note} <span class="text-slate-600 ml-1">#${tm}</span></h4>
                                <p class="text-[9px] text-slate-500 font-bold uppercase">${i.user} â€¢ ${labelFinal}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-black ${i.status === 'Masuk' ? 'text-macca-green' : 'text-white'}">${i.status === 'Masuk' ? '+' : '-'}${i.qty}</p>
                            ${i.price > 0 ? `<p class="text-[9px] font-bold ${isQRIS ? 'text-macca-purple' : 'text-macca-green'}">Rp ${(i.qty * i.price).toLocaleString()}</p>` : '<p class="text-[9px] font-bold text-slate-600 italic">Rp 0</p>'}
                        </div>
                    </div>` + hl.innerHTML;
                }
            });

            // Update UI
            document.getElementById('stat-mentah-main').innerText = sM;
            document.getElementById('stat-ungkep-main').innerText = sU;
            document.getElementById('stat-ikan-main').innerText = sI;
            document.getElementById('total-omzet').innerText = "Rp " + omzHarianTunai.toLocaleString();
            document.getElementById('count-ayam-sales').innerText = aQtyTunai;
            document.getElementById('count-ikan-sales').innerText = iQtyTunai;
            document.getElementById('omzet-ayam').innerText = "Rp " + aOmzTunai.toLocaleString();
            document.getElementById('omzet-ikan').innerText = "Rp " + iOmzTunai.toLocaleString();

            const rh = document.getElementById('rekap-harian-body'); rh.innerHTML = '';
            Object.keys(rekapHarian).sort().forEach(key => {
                const color = key.includes('QRIS') ? 'text-macca-purple' : (rekapHarian[key].total > 0 ? 'text-macca-yellow' : 'text-slate-500');
                rh.innerHTML += `<tr class="border-b border-white/5">
                    <td class="py-3 text-slate-300 font-bold uppercase">${key}</td>
                    <td class="py-3 text-right font-black text-white">${rekapHarian[key].qty}</td>
                    <td class="py-3 text-right font-black ${color}">Rp ${rekapHarian[key].total.toLocaleString()}</td>
                </tr>`;
            });

            const rb = document.getElementById('rekap-table-body'); rb.innerHTML = '';
            Object.keys(rekapBulanan).sort().forEach(key => {
                const color = key.includes('QRIS') ? 'text-macca-purple' : (rekapBulanan[key].total > 0 ? 'text-macca-yellow' : 'text-slate-500');
                rb.innerHTML += `<tr class="border-b border-white/5">
                    <td class="py-3 text-slate-300 font-bold uppercase">${key}</td>
                    <td class="py-3 text-right font-black">${rekapBulanan[key].qty}</td>
                    <td class="py-3 text-right font-black ${color}">Rp ${rekapBulanan[key].total.toLocaleString()}</td>
                </tr>`;
            });
            document.getElementById('rekap-total-qty').innerText = rGrandQ;
            document.getElementById('rekap-grand-total').innerText = "Rp " + rGrandT.toLocaleString();
        }
    </script>
</body>
</html>
